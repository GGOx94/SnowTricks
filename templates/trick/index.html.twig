{% extends 'base.html.twig' %}

{% block title %}{{ trick.title }}{% endblock %}

{% block body %}

    {# TODO MOVE TMP STYLE HERE TO CSS #}
    <style>
        .trick-container {
            padding-top: 5vh;
        }
        .hero {
            position: relative;
            background-color: #3c9b5f;
        }
        .hero .title {
            position: absolute;
            top:45%;
        }
        .hero .picture {
            width:100%;
            max-height: 600px;
        }

        .comments {
            display: flex;
            flex-direction: column;
            gap:1em;
        }
        .comment {
            display: flex;
            align-items: flex-start;
        }
        .comment .author {
        }
        .comment .content {
            position:relative;
            margin: 0;
            padding: 0;
            border: black solid thin;
            min-height:80px;
        }
        .comment small {
            position:absolute;
            right:0;
            bottom: 0;
            color: #a4a4a4;
        }

        .comment img {
            width: 50px;
            height: 50px;
        }

        .trick-media-carousel-container {
            display: flex;
            justify-items: center;
            gap: 1em;
            padding: 5px 0;
        }

        .btn-prev, .btn-next {
            border: none;
            background-color: transparent;
            cursor: pointer;
            color: #0d92bd;
            font-size: 2rem;
        }

        .trick-media-carousel {
            display: flex;
            justify-items: center;
            overflow-x: scroll;
            scroll-behavior: smooth;
        }

        .trick-media-carousel::-webkit-scrollbar {
            display: none;
        }

        .media  {
            flex-basis: 16.67%; /* Allow for 6 medias displayed on carousel */
            flex-shrink: 0;
            padding: 0.5rem;
        }
        .media .picture, .media .video {
            width: 100%;
            height: 120px;
        }
    </style>

<div class="trick-container container">

    {% set mainPic = trick.pictures is empty ?
        picturesUri ~ "default.png" :
        picturesUri ~ trick.slug ~ "/" ~ trick.pictures|first.fileName
    %}
    <div class="hero text-center"> {# TODO : darken picture & white text ? #}
        <h1 class="title display-1 fw-bold text-center w-100">{{ trick.title|raw }}</h1>
        <img src="{{ mainPic }}" class="picture" alt="PrÃ©sentation du trick {{ trick.title|raw }}">
    </div>

    <div class="trick-media-carousel-container">
        <button class="btn-prev">&lt;</button> {# TODO don't show carousel control buttons if no medias #}

        <div class="trick-media-carousel">
            {% for pic in trick.pictures[1:] %} {# Skip first picture (displayed as mainPic) #}
                <div class="media">
                    <img class="picture" src="{{ picturesUri ~ trick.slug ~ "/" ~ pic.fileName }}" alt="Image du trick {{ trick.title|raw }}">
                </div>
            {% endfor %}

            {% for vid in trick.videos %}
                <div class="media">
                    <iframe class="video" src="{{ vid.embedUrl }}" allowfullscreen></iframe>
                </div>
            {% endfor %}
        </div>

        <button class="btn-next">&gt;</button>
    </div>

    {# TODO MOVE THAT IN A CAROUSEL.JS SCRIPT #}
    <script>

        let mediaCrsl = document.querySelector('.trick-media-carousel');
        let prv = document.querySelector('.btn-prev');
        let nxt = document.querySelector('.btn-next');
        let media = document.querySelector('.media');

        nxt.addEventListener('click', function() { mediaCrsl.scrollLeft += media.clientWidth; });
        prv.addEventListener('click', function() { mediaCrsl.scrollLeft -= media.clientWidth; });

    </script>

    {# TODO see wireframes to place those buttons #}
    {# TODO hide in edit mode #}
    <div>
        <a class='btn btn-info' href="{{ path('app_trick_edit', { 'slug': trick.slug }) }}">Modifier</a>
        <a class='btn btn-danger' href="#">Supprimer</a>
    </div>

    {% block trickBody %}{% endblock %}

</div>

{% endblock %}
